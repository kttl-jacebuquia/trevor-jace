{"version":3,"file":"theme/js/site-banners.js","sources":["webpack:///external \"jQuery\"","webpack:///./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack:///./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack:///./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","webpack:///./src/theme/js/site-banners/banner-manager.js","webpack:///./src/theme/js/site-banners/index.js","webpack:///./node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"],"sourcesContent":["module.exports = jQuery;","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import $ from 'jquery';\n\nexport default class SiteBanner {\n\tconstructor(bannerObj) {\n\t\tthis.$eventEmitter = $('<div></div>'); // A dummy element to use just as an eventemitter\n\t\tthis.$container = $('#siteBannerContainer');\n\t\tthis.$banner = null;\n\t\tthis.bannerObj = bannerObj;\n\t\tthis.sessionName = `sessionBannerObj-${this.bannerObj.id}`;\n\t\tthis.containerHeight = 0;\n\t\tthis.id = bannerObj.id;\n\t}\n\n\t// Checks to see if this banner is\n\t// not yet closed and is not in excluded page\n\tisRenderable() {\n\t\treturn !this.isClosed() && this.isAllowedInPage();\n\t}\n\n\tisAllowedInPage() {\n\t\tconst postIDMeta = document.querySelector('meta[name=\"post-id\"]');\n\t\tconst currentPost = postIDMeta?.getAttribute('content');\n\n\t\treturn (\n\t\t\tNumber(this.bannerObj.exclude_in || '') !== Number(currentPost || 0)\n\t\t);\n\t}\n\n\trender() {\n\t\tthis.build();\n\t\tthis.insert();\n\t}\n\n\tinsert() {\n\t\tif (this.$banner.data('type') === 'custom') {\n\t\t\tthis.$banner.prependTo(this.$container);\n\t\t} else {\n\t\t\tthis.$banner.appendTo(this.$container);\n\t\t}\n\n\t\tthis.updateSiteBannerCSSvariable();\n\t}\n\n\tbuild() {\n\t\tconst { bannerObj } = this;\n\n\t\tthis.$banner = $('<div/>', {\n\t\t\tclass: `site-banner__${bannerObj.type}`,\n\t\t\tid: `site-banner-${bannerObj.id}`,\n\t\t\t'data-type': bannerObj.type,\n\t\t\t'data-id': bannerObj.id,\n\t\t\ttabindex: 0,\n\t\t});\n\t\tconst $container = $(\n\t\t\t\"<div class='site-banner__container'>\" +\n\t\t\t\t\"<i class='site-banner__warning'></i>\" +\n\t\t\t\t'</div>'\n\t\t).appendTo(this.$banner);\n\n\t\t// Text\n\t\tconst $text = $(\"<p class='site-banner__text'></p>\").appendTo(\n\t\t\t$container\n\t\t);\n\n\t\t// Title\n\t\tif (bannerObj.title) {\n\t\t\t$('<span/>', {\n\t\t\t\tclass: 'site-banner__title',\n\t\t\t\thtml: `${bannerObj.title} `,\n\t\t\t}).appendTo($text);\n\t\t}\n\n\t\t// Description\n\t\tif (bannerObj.desc) {\n\t\t\t$('<span/>', {\n\t\t\t\tclass: 'site-banner__description',\n\t\t\t\thtml: bannerObj.desc,\n\t\t\t}).appendTo($text);\n\t\t}\n\n\t\t// Link (for pride_promo type)\n\t\tif (bannerObj.type === 'pride_promo') {\n\t\t\t$('<a/>', {\n\t\t\t\tclass: 'site-banner__pride-promo-link',\n\t\t\t\ttext: bannerObj.link_text,\n\t\t\t\thref: bannerObj.link_url,\n\t\t\t}).appendTo($text);\n\t\t}\n\n\t\t$(\n\t\t\t\"<button aria-label='click to close banner' class='site-banner__close-btn'>\" +\n\t\t\t\t\"<i class='trevor-ti-x text-indigo'></i>\" +\n\t\t\t\t'</button>'\n\t\t)\n\t\t\t.on('click', this.handleCloseClick)\n\t\t\t.appendTo($container);\n\t}\n\n\thandleCloseClick = (e) => {\n\t\te.preventDefault();\n\n\t\tconst { originalEvent } = e;\n\n\t\twindow.sessionStorage.setItem(this.sessionName, Date.now());\n\n\t\t// Using originalEvent to determine if event is an actual mouse click or not\n\t\tthis.remove({\n\t\t\ttrueClick: originalEvent.offsetX > 0 && originalEvent.offsetY > 0,\n\t\t});\n\n\t\tthis.updateSiteBannerCSSvariable();\n\t};\n\n\tisClosed() {\n\t\treturn Object.keys(window.sessionStorage).includes(this.sessionName);\n\t}\n\n\tremove(eventTriggerData) {\n\t\tthis.$banner.remove();\n\t\tthis.$eventEmitter.trigger('remove', eventTriggerData);\n\t}\n\n\tupdateSiteBannerCSSvariable() {\n\t\tconst root = document.documentElement;\n\t\tthis.containerHeight = this.$container.height();\n\t\troot.style.setProperty(\n\t\t\t'--site-banner-height',\n\t\t\t`${this.containerHeight}px`\n\t\t);\n\t}\n\n\ton(event, callback) {\n\t\tthis.$eventEmitter.on(event, (originalEvent, data) => {\n\t\t\tcallback.apply(this, [\n\t\t\t\tthis,\n\t\t\t\t{\n\t\t\t\t\t...originalEvent,\n\t\t\t\t\tdata,\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t}\n}\n","import $ from 'jquery';\nimport SiteBanner from './banner-manager';\n\nwindow.trevorWP = window.trevorWP || {};\nwindow.trevorWP.siteBanners = () => {\n\tconst bannersById = {};\n\n\tconst onRemove = ({ id }, event) => {\n\t\t// Remove closed banner\n\t\tdelete bannersById[id];\n\n\t\t// Focus on next available banner\n\t\tconst availableBanner = Object.values(bannersById)[0];\n\n\t\tif (availableBanner) {\n\t\t\tavailableBanner.$banner.focus();\n\t\t} else if (event.data?.trueClick === false) {\n\t\t\t// Focus on skip to main link instead if no more banners\n\t\t\t// only when tabbing/voiceover was used\n\t\t\tdocument.body.focus();\n\t\t}\n\t};\n\n\t$.get('/wp-json/trevor/v1/site-banners?nonce=' + Date.now()).then(\n\t\t(resp) => {\n\t\t\tif (resp.success) {\n\t\t\t\t// Show only up to 2 banners at a time,\n\t\t\t\t// with the Pride LP having least priority\n\t\t\t\tresp.banners\n\t\t\t\t\t.map((bannerObj) => new SiteBanner(bannerObj))\n\t\t\t\t\t.filter((banner) => banner.isRenderable())\n\t\t\t\t\t.slice(0, 2)\n\t\t\t\t\t.forEach((banner) => {\n\t\t\t\t\t\tbanner.render();\n\t\t\t\t\t\tbanner.on('remove', onRemove);\n\t\t\t\t\t\tbannersById[banner.id] = banner;\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t);\n};\n","import defineProperty from \"./defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}"],"mappings":";;;;;AAAA;;;;;;;;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACbA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;ACJA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AADA;AAgGA;AADA;AAKA;AACA;AAEA;AACA;AADA;AACA;AAGA;AACA;AACA;AA5GA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;;;AADA;AACA;AACA;;;AAEA;AACA;AACA;AAEA;AAGA;;;AAEA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAMA;AACA;AAIA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAOA;;;AAiBA;AACA;AACA;;;AAEA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAIA;;;AAEA;AAAA;AACA;AAAA;AACA;AAIA;AAJA;AAOA;AACA;;;;;;;;AC7IA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;ACxCA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}